import { HttpClient } from '@angular/common/http';
import { Component, ElementRef, OnInit, ViewChild } from '@angular/core';

@Component({
  selector: 'app-keypads',
  templateUrl: './keypads.component.html',
  styleUrls: ['./keypads.component.css'],
})
export class KeypadsComponent implements OnInit {
  @ViewChild('button1') button1!: ElementRef;
  @ViewChild('button2') button2!: ElementRef;
  @ViewChild('button3') button3!: ElementRef;
  @ViewChild('button4') button4!: ElementRef;

  solutions = [
    ['1', '2', '3', '4'],
    ['2', '4', '3', '1'],
  ];
  selectedSolution: string[] = [];
  userInput: string[] = [];

  constructor(private http: HttpClient) {}

  ngOnInit() {
    this.selectedSolution = this.solutions[Math.floor(Math.random() * 2)];
  }

  async checkSolution(reference: HTMLButtonElement) {
    reference.classList.add('buttonPressed');
    reference.disabled = true;
    //await this.sleep(500);

    if (this.userInput.length == 3) {
      this.userInput.push(reference.value);

      const response = await this.http
        .post(`https://suas206-vm.su.ro.conti.de:36299/RightOrder`, {
          payload: {
            input: this.userInput.join(''),
            solutionSelected: this.selectedSolution.join(''),
          },
        })
        .subscribe({
          next: (response) => {
            console.log('response:', response);
            this.resetButtons();
            this.userInput.length = 0;
          },
          error: (error) => {
            console.log('error:', error);
            this.resetButtons();
            this.userInput.length = 0;
          },
        });
    } else {
      this.userInput.push(reference.value);
    }
  }

  resetButtons() {
    this.button1.nativeElement.classList.remove('buttonPressed');
    this.button1.nativeElement.disabled = false;
    this.button2.nativeElement.classList.remove('buttonPressed');
    this.button2.nativeElement.disabled = false;
    this.button3.nativeElement.classList.remove('buttonPressed');
    this.button3.nativeElement.disabled = false;
    this.button4.nativeElement.classList.remove('buttonPressed');
    this.button4.nativeElement.disabled = false;
  }
}
